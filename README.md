# CsvToAsset
> Migrate legacy PAM assets to new Asset Manager assets (_available since 3.2_), using CSV file import.

# Installation
First, clone this repository, then:

## Without Docker

```bash
composer install
```

## With Docker

```bash
docker-compose up
docker-compose run -u www-data --rm php php composer install
```

# Setup
Note: to setup this tool, you'll need a valid **API Client ID** and its **API Client secret** from your Akeneo PIM instance. Read the dedicated documentation to proceed: https://api.akeneo.com/getting-started-admin.html

Back in tool, you need to copy the [.env](https://symfony.com/doc/current/components/dotenv.html) file:
```bash
cp .env .env.local
```

Then open `.env.local` to define the needed configuration vars:
```
AKENEO_API_BASE_URI=http://your-akeneo-pim-instance.com
AKENEO_API_CLIENT_ID=123456789abcdefghijklmnopqrstuvwxyz
AKENEO_API_CLIENT_SECRET=123456789abcdefghijklmnopqrstuvwxyz
AKENEO_API_USERNAME=admin
AKENEO_API_PASSWORD=admin
```

# How to Use

This tools provides several commands to migrate your PAM assets to the Asset Manager assets.

## `app:create-family [familyCode]`
> This command creates (using the API) an Asset Family with attributes needed to support legacy PAM structure:
- `reference` (_media_file attribute_)
- `reference_localizable` (_media_file attribute_)
- `variation_scopable` (_media_file attribute_)
- `variation_localizable_scopable` (_media_file attribute_)
- `description` (_text attribute_)
- `categories` (_text attribute_)
- `tags` (_text attribute_)
- `end_of_use` (_text attribute_)

Ex: `php bin/console app:create-family my_asset_family`

## `app:merge-files [assetsFilePath] [variationsFilePath] [targetFilePath]`
> This command merges one assets CSV file (`assetsFilePath`) and a variations CSV file (`variationsFilePath`) into one single file (`targetFilePath`), ready to be imported by another command.

**Note regarding memory:** This command loads some values in memory and thus can result in a `PHP Fatal error: Out of memory`.
This can happen if you have:
- A lot of **localizable assets and a lot of locales**
- A **lot variations** (more than 1 million)

If you encounter this problem, we encourage you to increase memory limit when running this command by adding `-d memory_limit=4G` for example.

Ex: `php bin/console app:merge-files var/assets.csv var/variations.csv var/new_assets.csv`

## `app:import [filePath] [assetFamilyCode]`
> This command imports in the given Asset Family, a given Asset Manager CSV files into the PIM using the API. The `filePath` file should be a file generated by the `merge-files` command.


Ex: `php bin/console app:import var/new_assets.csv my_asset_family`
